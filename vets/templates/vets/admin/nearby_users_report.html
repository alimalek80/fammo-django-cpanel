{% extends 'admin/base_site.html' %}
{% load i18n %}

{% block title %}{% trans "Nearby Users Report" %} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block content %}
<div class="module">
  <h1>{% trans "Nearby Users Report" %}</h1>
  <p>
    <strong>{% trans "Clinic" %}:</strong> {{ clinic.name }}<br>
    {% if clinic_has_coords %}
      <strong>{% trans "Coordinates" %}:</strong> {{ clinic.latitude }}, {{ clinic.longitude }}
    {% else %}
      <span style="color: #b91c1c;">{% trans "This clinic has no coordinates set. Add latitude/longitude to enable proximity reports." %}</span>
    {% endif %}
  </p>

  <form method="get" class="form-row">
    <label for="radius">{% trans "Radius (km)" %}:</label>
    <input type="number" step="0.1" name="radius" id="radius" value="{{ radius_km }}" />
    <button type="submit" class="button default">{% trans "Update" %}</button>
  </form>

  {% if users %}
  <h2 style="margin-top: 1rem;">{% trans "Users within" %} {{ radius_km }} km</h2>
  <table class="listing">
    <thead>
      <tr>
        <th>{% trans "Email" %}</th>
        <th>{% trans "Name" %}</th>
        <th>{% trans "City" %}</th>
        <th>{% trans "Distance (km)" %}</th>
        <th>{% trans "Updated" %}</th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr>
        <td>{{ u.email }}</td>
        <td>{{ u.first_name }} {{ u.last_name }}</td>
        <td>{{ u.city }}</td>
        <td>{{ u.distance_km }}</td>
        <td>{{ u.location_updated_at|date:'Y-m-d H:i' }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p style="margin-top: 1rem; color:#374151;">{% trans "No users with stored location within the selected radius." %}</p>
  {% endif %}
</div>
{% endblock %}
