{% extends "userapp/dashboard_base.html" %}
{% load i18n %}
{% load markdownify %}

{% block dashboard_content %}
<!-- Main container for the subscription plans page -->
<div class="max-w-7xl mx-auto p-6 bg-white shadow-lg mt-10 rounded-lg">
    <!-- Page heading -->
    <div class="text-center mb-12">
        <h1 class="text-4xl font-extrabold text-gray-900 sm:text-5xl lg:text-6xl mb-4">
            {% trans "Choose Your Plan" %}
        </h1>
        <p class="text-xl text-gray-600">
            Simple, transparent pricing. No contracts, no hidden fees.
        </p>
    </div>

    <!-- Plan selection form -->
    <form method="post">
        {% csrf_token %}
        <!-- Responsive grid: 1 column on mobile, 3 columns on desktop -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            {% for plan in plans %}
            <!-- Each plan card is a label for the radio input -->
            <label class="group cursor-pointer block h-full">
                <!-- Outer card container with hover effect -->
                <div class="p-8 rounded-3xl shadow-xl flex flex-col h-full transform transition-transform duration-300
                    {% if current_plan == plan %}
                        bg-indigo-600 text-white
                    {% else %}
                        bg-white text-gray-900 hover:scale-105
                    {% endif %}">

                    <!-- Plan name and price -->
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold">
                            {{ plan.get_name_display }}
                        </h2>
                        <p class="mt-4 text-5xl font-extrabold">
                            {% if plan.price_eur > 0 %}
                                â‚¬{{ plan.price_eur }}
                            {% else %}
                                Free
                            {% endif %}
                        </p>
                        <p class="mt-2 text-base font-medium {% if current_plan == plan %}text-indigo-200{% else %}text-gray-500{% endif %}">
                            / mo
                        </p>
                    </div>

                    <!-- Radio button for selection -->
                    <div class="absolute top-6 left-6">
                        <input type="radio" name="plan_id" value="{{ plan.id }}" class="h-5 w-5 rounded-full border-gray-300 accent-indigo-600 focus:ring-indigo-500"
                            {% if current_plan == plan %}checked{% endif %}>
                    </div>

                    <!-- Plan features list -->
                    <div class="mt-8 flex-1">
                        <ul role="list" class="space-y-4">
                            <!-- Dynamically loaded features from Django context -->
                            <li class="flex items-start">
                                <span class="flex-shrink-0">
                                    <svg class="h-6 w-6 {% if current_plan == plan %}text-indigo-300{% else %}text-green-500{% endif %}" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                    </svg>
                                </span>
                                <p class="ml-3 text-base {% if current_plan == plan %}text-indigo-100{% else %}text-gray-600{% endif %}">
                                    {% if plan.unlimited_meals %}
                                        Unlimited AI meal suggestions / month
                                    {% else %}
                                        {{ plan.monthly_meal_limit }} AI meal suggestions / month
                                    {% endif %}
                                </p>
                            </li>
                            <li class="flex items-start">
                                <span class="flex-shrink-0">
                                    <svg class="h-6 w-6 {% if current_plan == plan %}text-indigo-300{% else %}text-green-500{% endif %}" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                    </svg>
                                </span>
                                <p class="ml-3 text-base {% if current_plan == plan %}text-indigo-100{% else %}text-gray-600{% endif %}">
                                    {% if plan.unlimited_health %}
                                        Unlimited health reports / month
                                    {% else %}
                                        {{ plan.monthly_health_limit }} health reports / month
                                    {% endif %}
                                </p>
                            </li>
                        </ul>
                        <!-- Markdownx description: rich offers rendered as HTML -->
                        <div class="markdown-content prose prose-sm mt-4 {% if current_plan == plan %}prose-invert{% endif %}">
                            {{ plan.description|markdownify }}
                        </div>
                    </div>
                </div>
            </label>
            {% endfor %}
        </div>
        <!-- Submit button for updating the selected plan -->
        <div class="flex justify-center mt-8">
            <button type="submit" class="w-full md:w-auto bg-indigo-600 text-white px-6 py-3 rounded-full font-semibold hover:bg-indigo-700 transition">
                {% trans "Update Plan" %}
            </button>
        </div>
    </form>
</div>
{% endblock %}
