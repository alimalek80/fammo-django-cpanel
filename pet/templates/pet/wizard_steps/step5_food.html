<!-- Food Type Selection Section -->
<div class="mb-6">
  <div class="mb-6 text-lg font-medium text-center opacity-90">
    {% if form.pet_name %}
      What is {{ form.pet_name }} currently eating?
    {% else %}
      {{ form.food_types.label }}
    {% endif %}
  </div>
  
  <!-- Food Type Options -->
  <div class="grid grid-cols-2 gap-4 max-w-2xl mx-auto">
    {% for choice in form.food_types %}
      <label class="btn btn-outline btn-lg cursor-pointer food-type-btn hover:btn-primary transition-all duration-200 flex items-center justify-center">
        {{ choice.tag }}
        <span class="ml-2 text-lg">{{ choice.choice_label }}</span>
      </label>
    {% endfor %}
  </div>
  
  <!-- Error Display -->
  {% for error in form.food_types.errors %}
    <div class="text-error text-sm mt-4 text-center">{{ error }}</div>
  {% endfor %}
  
  <!-- Form-level errors -->
  {% if form.non_field_errors %}
    {% for error in form.non_field_errors %}
      <div class="text-error text-sm mt-2 text-center">{{ error }}</div>
    {% endfor %}
  {% endif %}
</div>

<!-- Store pet name for JavaScript -->
<script>
  window.petNameStep5 = '{{ form.pet_name|default:"" }}';
  
  // Step 5: Food type selection handling
  document.addEventListener('DOMContentLoaded', function() {
      const foodTypeButtons = document.querySelectorAll('.food-type-btn');
      
      function updateButtonStates() {
          foodTypeButtons.forEach(function(button) {
              const checkbox = button.querySelector('input[type="checkbox"]');
              if (checkbox && checkbox.checked) {
                  button.classList.add('btn-primary');
                  button.classList.remove('btn-outline');
              } else {
                  button.classList.remove('btn-primary');
                  button.classList.add('btn-outline');
              }
          });
      }
      
      // Add click handlers to buttons
      foodTypeButtons.forEach(function(button) {
          button.addEventListener('click', function() {
              const checkbox = this.querySelector('input[type="checkbox"]');
              if (checkbox) {
                  checkbox.checked = !checkbox.checked;
                  updateButtonStates();
              }
          });
      });
      
      // Set initial button states
      updateButtonStates();
      
      // Listen for direct checkbox changes (in case user clicks checkbox directly)
      document.querySelectorAll('input[name="step5-food_types"]').forEach(function(checkbox) {
          checkbox.addEventListener('change', updateButtonStates);
      });
  });
</script>

<style>
  /* Hide the actual checkboxes but keep them functional */
  .food-type-btn input[type="checkbox"] {
      position: absolute;
      opacity: 0;
      pointer-events: none;
  }
  
  /* Ensure button text is centered and styled properly */
  .food-type-btn {
      min-height: 4rem;
      font-weight: 500;
  }
  
  /* Hover effects */
  .food-type-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }
  
  /* Active state styling */
  .food-type-btn.btn-primary {
      color: white;
  }
</style>