<!-- Body Type Selection Section -->
<div class="mb-6">
  <div class="mb-6 text-lg font-medium text-center opacity-90">
    {% if form.pet_name %}
      What does {{ form.pet_name }}'s body look like?
    {% else %}
      {{ form.body_type.label }}
    {% endif %}
  </div>
  
  <!-- Body Type Options -->
  <div class="grid grid-cols-1 gap-4 max-w-2xl mx-auto">
    {% for choice in form.body_type %}
      <label class="btn btn-outline btn-lg cursor-pointer body-type-btn hover:btn-primary transition-all duration-200 p-6 h-auto text-left">
        {{ choice.tag }}
        <div class="ml-4 flex-1">
          <div class="text-xl font-bold mb-2">{{ choice.choice_label }}</div>
          <div class="text-sm opacity-75 font-normal">
            {% for body_type in form.body_types_with_descriptions %}
              {% if body_type.name == choice.choice_label %}
                {{ body_type.description }}
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </label>
    {% endfor %}
  </div>
  
  <!-- Error Display -->
  {% for error in form.body_type.errors %}
    <div class="text-error text-sm mt-4 text-center">{{ error }}</div>
  {% endfor %}
  
  <!-- Form-level errors -->
  {% if form.non_field_errors %}
    {% for error in form.non_field_errors %}
      <div class="text-error text-sm mt-2 text-center">{{ error }}</div>
    {% endfor %}
  {% endif %}
</div>

<!-- Store pet name for JavaScript -->
<script>
  window.petNameStep8 = '{{ form.pet_name|default:"" }}';
  
  // Step 8: Body type selection handling
  document.addEventListener('DOMContentLoaded', function() {
      const bodyTypeButtons = document.querySelectorAll('.body-type-btn');
      
      function updateButtonStates() {
          bodyTypeButtons.forEach(function(button) {
              const radio = button.querySelector('input[type="radio"]');
              if (radio && radio.checked) {
                  button.classList.add('btn-primary');
                  button.classList.remove('btn-outline');
              } else {
                  button.classList.remove('btn-primary');
                  button.classList.add('btn-outline');
              }
          });
      }
      
      // Add click handlers to buttons
      bodyTypeButtons.forEach(function(button) {
          button.addEventListener('click', function() {
              const radio = this.querySelector('input[type="radio"]');
              if (radio) {
                  // Uncheck all other radios first
                  document.querySelectorAll('input[name="step8-body_type"]').forEach(function(r) {
                      r.checked = false;
                  });
                  // Check this radio
                  radio.checked = true;
                  updateButtonStates();
              }
          });
      });
      
      // Set initial button states
      updateButtonStates();
      
      // Listen for direct radio changes (in case user clicks radio directly)
      document.querySelectorAll('input[name="step8-body_type"]').forEach(function(radio) {
          radio.addEventListener('change', updateButtonStates);
      });
  });
</script>

<style>
  /* Hide the actual radio buttons but keep them functional */
  .body-type-btn input[type="radio"] {
      position: absolute;
      opacity: 0;
      pointer-events: none;
  }
  
  /* Ensure button content is properly styled */
  .body-type-btn {
      justify-content: flex-start !important;
      text-align: left !important;
  }
  
  /* Selected state styling */
  .body-type-btn.btn-primary {
      background-color: #3b82f6 !important;
      color: white !important;
      border-color: #3b82f6 !important;
  }
  
  /* Ensure text inside selected button is visible */
  .body-type-btn.btn-primary * {
      color: white !important;
  }
  
  /* Hover state */
  .body-type-btn:hover:not(.btn-primary) {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      border-color: #3b82f6 !important;
      background-color: #eff6ff !important;
  }
  
  /* Focus state for accessibility */
  .body-type-btn:focus {
      outline: 2px solid #3b82f6;
      outline-offset: 2px;
  }
</style>